
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PND4</title>
  <meta name="author" content="">

  
  <meta name="description" content="As of 2013, some streams require the &lsquo;ksv&rsquo;/&lsquo;k-s-v&rsquo; patch.. Arch users can use rtmpdump-ksv instead of rtmpdump Commands &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pnd4.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="PND4" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Coda:400,800' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">PND4</a></h1>
  
    <h2>/dev/notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pnd4.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/profile/">Profile</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/23/rtmpdump/">CLI RTMP Streaming</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-23T00:00:00-08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As of 2013, some streams require the &lsquo;ksv&rsquo;/&lsquo;k-s-v&rsquo; patch.. Arch users can use <strong>rtmpdump-ksv</strong> instead of <strong>rtmpdump</strong></p>

<h3>Commands</h3>

<p>Redirect rtmp port using iptables.</p>

<pre><code>sudo iptables -t nat -A OUTPUT -p tcp --dport 1935 -j REDIRECT
</code></pre>

<p>Sniffing for stream parameters.</p>

<pre><code>rtmpsrv
</code></pre>

<p>Once you&rsquo;ve captured a stream, you can undo the redirection.</p>

<pre><code>sudo iptables -t nat -D OUTPUT -p tcp --dport 1935 -j REDIRECT
</code></pre>

<p>Use rtmpdump like so, piping the output to mplayer/vlc</p>

<pre><code>rtmpdump -q -r "rtmpe://origin.hdcast.org:1935/redirect/" -a "redirect/" -f "LNX 11,9,900,152" -W "http://www.udemy.com/static/flash/player5.9.swf" -p "http://www.hdcast.org/embedlive2.php?u=ban5&amp;vw=640&amp;vh=460&amp;domain=www.btsportshd.com" -y "ban5" -b "10000" -v | mplayer -really-quiet -framedrop -
</code></pre>

<h4>Important options</h4>

<p>rtmpdump</p>

<ul>
<li>-r [tcURL ex. &ldquo;rtmp://stream.url/&rdquo;]</li>
<li>-a [app ex. &ldquo;redirect/&rdquo;</li>
<li>-y [playpath ex. &ldquo;freetv4&rdquo;]</li>
<li>-v [live]</li>
<li>-b [buffersize ex. &ldquo;10000&rdquo;]</li>
<li>-W [swfURL ex. &ldquo;<a href="http://stream.url/flash/player5.9.swf">http://stream.url/flash/player5.9.swf</a>&rdquo;]</li>
</ul>


<p>mplayer</p>

<ul>
<li>-really-quiet [Suppresses output.]</li>
<li>-framedrop [Helps with streams.]</li>
<li><ul>
<li>[Plays from stdout.]</li>
</ul>
</li>
</ul>


<h4>Port redirect helper script</h4>

<p>I wrote a bash script that takes the hard part, remembering, out of the <strong>iptables</strong> step.</p>

<div>
  <pre><code class='bash'>#!/bin/bash

## PND4
## o1.27.13

success() {
  echo &quot;.. success :)&quot;
}

failure() {
  echo &quot;-- FAILURE :(&quot;
}

add-rule() {
  sudo iptables -t nat -A OUTPUT -p tcp --dport 1935 -j REDIRECT
}

del-rule() {
  sudo iptables -t nat -D OUTPUT -p tcp --dport 1935 -j REDIRECT
}

case &quot;$1&quot; in
  start)
    echo &quot;Starting..&quot;
    # also delete rule if it exists for some reason to avoid dupes.
    # always errors out so we ignore it
    del-rule 2&gt;/dev/null
    add-rule
    [ $? -eq 0 ] &amp;&amp; success || failure
    ;;
  stop)
    echo &quot;Stopping..&quot;
    del-rule
    [ $? -eq 0 ] &amp;&amp; success || failure
    ;;
  *)
    echo &quot;Usage: $0 &lt;start|stop&gt;&quot;
    ;;
esac</code></pre>
</div>


<h4>Useful Links and References</h4>

<ol>
<li><a href="http://stream-recorder.com/forum/tutorial-simply-use-rtmpsrv-and-example-t6325.html?p=18142">rtmpsrv tutorial</a></li>
<li><a href="http://trac.xbmc.org/ticket/14089">XBMC: hint on buffer option</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/11/motion-webcam/">Motion Webcam</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-11T00:00:00-08:00" pubdate data-updated="true">Nov 11<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Webcam Prices</h3>

<p>11.11.2013
&ndash; 20-23 HD-3000
&ndash; 15-20 Rocketfish 720p RF-HDWEB
&ndash; 17 M$ HD-2300</p>

<h3><a href="http://forum.micasaverde.com/index.php?topic=9104.15">RasPi Notes</a></h3>

<p>RasPi community has good info on the subject. Should be valid for Pogoplugs too.</p>

<blockquote><p>My Raspberry Pi was ordered just over a month ago and supposedly I&rsquo;ll have it in another two months. A friend of mine ordered one two weeks ago and he already has his.  ???</p>

<p>In the interim I wanted to chip in with some experiences I have using USB webcams with Vera. I attached mine to Pogoplugs running Archlinux ARM. That distro is available for the Raspberry Pi and I&rsquo;ve been very happy with it on my Pogoplugs. You should be able to support streaming quite a few webcams on your Raspberry Pi, I have as many as four hanging off my Pogoplugs.</p>

<p>A few recommendations I have for streaming USB webcams with linux:</p>

<ol>
<li><p>Unless you need the capabilities of motion (that is, you are using the motion detection built in to motion) use mjpg_streamer instead of motion. Motion processes each image to see if pixels have changed, and by default runs a lot of binary morphology on the images (erode, dilate, etc), where mjpg_streamer just streams. On my Pogoplus with four cameras this means the difference between 60%+ cpu utilization versus single digits (and to get down to 60% I had to drop the framerate to 2Hz and go through a bunch of options to turn off as much processing as possible). I have another machine running zoneminder which processes my streams which is why I don&rsquo;t mind forgoing motion detection.</p></li>
<li><p>Use MJPEG instead of YUV
If you want multiple webcams on a single USB bus this is basically a necessity. Even if you don&rsquo;t it means a lot less data to process. This is the default in mjpg_streamer, in motion set: &ldquo;v4l2_palette 2&rdquo; in motion.conf</p></li>
<li><p>Get a webcam with known support
Some webcams have a problem where the request a lot more bandwidth than they need and this means you can&rsquo;t use two at the same time. There is a hack to get around this in YUV mode, but not MJPEG which isn&rsquo;t much of a help. If you are up for hacking the driver yourself it should be possible to skip the BW check and make these work anyway, but that is quite a bit of work.</p></li>
</ol>


<p>Cameras that work simultaneously (no bandwidth bug):
-Logitech C120
-Logitech C160
-Logitech B500
-Logitech Quickcam E 3500
-Logitech Quickcam Messenger
-Microsoft HD-3000
-Microsoft HD-5000
-Rocketfish HD Webcam Pro</p>

<p>Cameras that do not work in multiples (bandwidth bug?):
-Logitech C110
-Logitech C310
-Creative Live! Cam Video IM Ultra
-HP 2-Megapixel Webcam (RZ406AA)</p>

<p>My current recommendation is probably the HD-3000. It is 720p and can be found for about $20. It does NOT have autofocus which I think is good for a webcam you leave running 24/7. I tried the HD-5000 and it spends a lot of time refocusing. I&rsquo;m afraid it would break after a few weeks. The C160 is currently the cheapest, about $8 shipped on ebay. Meritline sometimes sells it for $6. The irritating thing about the c120/c160 is that they have a focusing ring you have to adjust. For a security camera I would prefer fixed focus. I buy any webcam I can get at a firesale so I&rsquo;ll keep trying more &ndash; I would appreciate results from anyone else as well.</p>

<p>EDIT: Added a few more cameras]</p>

<p>It turns out you can disable autofocus on UVC supported webcams like this:</p>

<p>v4l2-ctl &mdash;verbose &mdash;set-ctrl=focus_auto=0</p>

<p>At least it works for me on all the AF cameras I have to test (Microsoft &amp; Rocketfish).</p>

<p>Not only is this a good idea for camera longevity (I would think so at least) it helps prevents false motion alarms.</p></blockquote>

<h4>Useful Links and References</h4>

<ol>
<li><a href="http://elinux.org/RPi_USB_Webcams">eLinux: RasPi Webcam compatibility list</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/09/gentoo-genkernel-upgrade/">Gentoo - Genkernel Upgrade Steps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-09T00:00:00-08:00" pubdate data-updated="true">Nov 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I use genkernel to install my kernel.. this isn&rsquo;t the best way to do things but for now it gets the job done. Gentoo isn&rsquo;t my primary distro so I sometimes forget the steps to go through when they push a new kernel.</p>

<h3>TL;DR/Commands</h3>

<p>After using &lsquo;eselect kernel [list|set #]&rsquo; to switch to the latest version</p>

<div>
  <pre><code class='bash'>zcat /proc/config.gz &gt; /usr/src/linux
    cd /usr/src/linux
    make oldconfig
    make modules_prepare
    emerge --ask @module-rebuild
    make
    # Now sit and wait til your childen get old and put you in a retirement home.
    make modules_install
    genkernel --no-menuconfig --no-clean --install all
    # Update your bootloader&#39;s config
    # Reboot and cross your fingers

    # Clean-up/delete old files from /boot
    # Clean-up old bootloader entries</code></pre>
</div>


<h4>Useful Links and References</h4>

<ol>
<li><a href="https://wiki.gentoo.org/wiki/Kernel/Upgrade" title="Kernel/Upgrade">Gentoo Wiki: Kernel/Upgrade</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/04/iptables-transmission-vpn/">IPTables + Transmission + VPN</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-04T00:00:00-08:00" pubdate data-updated="true">Nov 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Transmission doesn&rsquo;t have a way to bind to specific interfaces without patching, and I like the simplicity of using a package manager like &lsquo;pacman&rsquo; vs patching &lsquo;BindInterface&rsquo; into Transmission and building it from source. The work-around, since Transmission can bind to an IP, is to run a script with cron periodically.
The script should basically:</p>

<ul>
<li>first make sure the VPN is up and operational</li>
<li>correct transmission&rsquo;s config if the address isn&rsquo;t current.. [stop, edit, start]</li>
<li>definitely end with transmission running</li>
</ul>


<h3>Quote</h3>

<blockquote><p>Enforcing an application, for example a torrent client like Transmission, to always use the VPN interface or any particular network interface for that matter, is trivially simple using iptables on Debian, Ubuntu or any other GNU/Linux distro.
Personally, I am running Debian Sid on the Raspberry Pi. Occasionally I use it for downloading files ( legal stuff, seriously, believe me :D  ) using Transmission Bittorrent client over a VPN connection. Sometimes it happens that the VPN connection fails and doesn&rsquo;t reconnect for whatever reason and Transmission continues pulling stuff directly over my internet connection, which I would like to avoid. Fortunately it is very straightforward to enforce rules based on application owner UID. Transmission runs under the owner debian-transmission in Debian (use htop to check this) and the following two lines of iptables ensures that any process with owner having UID, debian-transmission, will not use any other network interface apart from the OpenVPN tunnel interface tun0</p></blockquote>

<pre><code>iptables -A OUTPUT -m owner --uid-owner debian-transmission -d 192.168.0.100 -j ACCEPT
iptables -A OUTPUT -m owner --uid-owner debian-transmission \! -o tun0 -j REJECT
</code></pre>

<blockquote><p>The first line ensures that, my Mac-mini having IP address 192.168.0.100 on the lan, can always access the web interface of transmission. The second line makes sure, no outgoing traffic can leave via anything other that tun0.
Peace of mind restored, thanks to iptables.</p></blockquote>

<h3>Code</h3>

<p>transmission-vpn-only.sh</p>

<p><em>Ver. ArchLinuxARM-110413</em></p>

<div>
  <pre><code class='bash'>#!/bin/sh

iface=&quot;tun0&quot;
service=&quot;transmission.service&quot;
config=&quot;/var/lib/transmission/.config/transmission-daemon/settings.json&quot;

# test if service is currently running
systemctl --quiet is-active $service
if [ $? -eq 0 ]; then
    # get the ip from the current config
    savedIP=$(cat $config | egrep -o &#39;\&quot;bind-address-ipv4\&quot;: \&quot;[^ ]*&#39; | cut -d&#39;&quot;&#39; -f4)
    # test if ip has changed and is no longer available
    ping -i1 -w2 -c1 $savedIP &gt;/dev/null
    if [[ $? -ne 0 || &quot;x$savedIP&quot; == &quot;x0.0.0.0&quot; ]]; then
        echo IP unavailable, stop and reconfigure transmission..
        systemctl stop $service
        # test if VPN went down completely
        ifconfig $iface &gt;/dev/null
        if [ $? -ne 0 ]; then
            echo Oops.. $iface not available, exiting without restarting transmission..
            exit 1
        fi
        # reconfigure transmission with new ip address
        sed -i &quot;s/\&quot;bind-address-ipv4\&quot;:.*\$/\&quot;bind-address-ipv4\&quot;: \&quot;$(ip a show dev $iface | egrep -o &#39;inet [^ ]* &#39; | cut -d&#39; &#39; -f2 | sed &#39;s/ //&#39;)\&quot;,/&quot; $config
        systemctl start $service
        echo Transmission started.
    fi
else
    echo &quot;Transmission isn&#39;t running..&quot;
    exit 1
fi</code></pre>
</div>


<h3>To-Do</h3>

<ul>
<li>Figure out how to &lsquo;BindInterface&rsquo;, if possible.</li>
<li>Revise transmission-vpn-only script.</li>
<li>Figure out why openvpn config leaves routes behind.</li>
</ul>


<h4>Useful Links and References</h4>

<ol>
<li><a href="http://www.botcyb.org/2012/11/force-application-to-use-vpn-using.html" title="BotCyborg">BotCyborg</a></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/21/solidworks-build/">Solidworks Rig</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-21T00:00:00-07:00" pubdate data-updated="true">Oct 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>Min Reqs (Win7x64)</h4>

<pre><code>CPU     Intel or AMD with SSE2 support. 64-bit OS recommended.
RAM     2GB+
HDD     5GB+
Video   Quadro/QuadroFX/FireGL/FirePro
</code></pre>

<h2>Notes regarding HW selection</h2>

<ul>
<li><a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16814195112">FirePro v3900</a> was best bang for buck. Good Solidworks reviews.</li>
<li>4GB of RAM will work, can always upgrade.</li>
<li>3.5Ghz Dual core + Hyper-Threading (<a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16819116775">i3-3220</a>/3240) should be plenty.</li>
</ul>


<p><a href="http://www.capinc.com/support/tips/solidworks-tech-tips-hardware">Capinc Solidworks HW Tips</a></p>

<ul>
<li>Video Card: VERY important</li>
<li>Proc: Solidworks is optimized for multiple cores</li>
<li>RAM:
Solidworks grabs 340mb on launch.
4gb+ is only necessary for very large assemblies (over 10,000 parts)</li>
<li>HD: Generally, does not affect Solidworks performance</li>
</ul>


<h2>Newegg specials for Oct.</h2>

<p><strong>&ldquo;i5&rdquo; Combo + FirePro V3900 [ ~$630 ] (until 10/25)</strong></p>

<p>Someone mentioned i5 &amp; i7&rsquo;s have decent enough graphics to run Solidworks.. maybe just get FirePro later, if needed?</p>

<ul>
<li>Trustworthy PSU</li>
<li>i5 is Quad Core, 8MB-L2, HD4000 &lsquo;integrated&rsquo; gfx</li>
<li>8GB RAM</li>
<li>1TB HDD, SSD would&rsquo;ve been nicer.</li>
<li>USB 3.0</li>
<li><p>No case.</p>

<p>  <a href="http://www.newegg.com/Product/ComboBundleDetails.aspx?ItemList=Combo.1291151">Combo: 1291151</a></p></li>
</ul>


<p><strong>&ldquo;i3&rdquo; Combo + FirePro V3900 [ ~$ 430 ] (until 10/31)</strong></p>

<ul>
<li>Decent PSU. But low wattage.</li>
<li>500GB HDD</li>
<li>USB 3.0</li>
<li><p>Plain Case.</p>

<p>  <a href="http://www.newegg.com/Product/ComboBundleDetails.aspx?ItemList=Combo.1271103">Combo: 1271103</a></p></li>
</ul>


<p><strong>&ldquo;Budget Gaming&rdquo; Combo [ $ 370 ] (until 10/31)</strong></p>

<ul>
<li>nVidia GT 640 2GB, instead of FirePro ?<br/>
  .. donno if that&rsquo;s such a good idea.</li>
<li>Good PSU</li>
<li>500GB HDD</li>
<li>USB 3.0</li>
<li><p>Decent looking case.</p>

<p>  <a href="http://www.newegg.com/Product/ComboBundleDetails.aspx?ItemList=Combo.1461943">Combo: 1461943</a></p></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Latest Topics</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/11/23/rtmpdump/">CLI RTMP Streaming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/11/motion-webcam/">Motion Webcam</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/09/gentoo-genkernel-upgrade/">Gentoo - Genkernel Upgrade Steps</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Git</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pnd4">@pnd4</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pnd4',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>









</body>
</html>
